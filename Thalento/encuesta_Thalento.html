<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>
<head>
    <title>Encuesta Calidad Audios</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }
        td.seleccionado {
            background-color: #e0e0e0; /* Gris claro */
        }
        audio {
            width: 100%;
        }

       .button_circ {
            background-color: #ccc; /* Color de fondo gris */
            color: black;
            border: none; /* Quitamos el borde */
            width: 20px; /* Ancho del botón */
            height: 20px; /* Altura del botón */
            border-radius: 50%; /* Hacemos que sea un círculo */
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }

        .button_circ.active {
            background-color: #ffa726;
            font-size: 8px;
            transform: scale(1.1);
        }
        td[contenteditable="true"] {
           background-color: #e0e0e0;
        }
        .editable {
            color: #888;
        }
        .editable:focus {
            color: black;
            outline: none;
        }
    </style>
</head>
<body>
    <h2>Encuesta Calidad Audios</h2>
  <br>
  <p>A continuación tendrás 100 audios generados de manera artificial de la persona que has elegido escuchar y un audio original de esa persona. Por favor escucha primero el audio original y luego dos audios al azar de esta persona(Si has realizado varias personas no escuches el mismo número que ya has escuchado). En la tabla que tienes justo debajo sigue los siguientes pasos:</p>
  <ol>
  <li> En la primera columna pon el audio que has escuchado. El nombre de este audio será el nombre que aparece a la derecha del audio, por ejemplo TVD-D-0001-0001. <em> Por favor tenga mucho cuidado cuando introduzca este nombre y pon tambien las barras "-" que hay de separación en el nombre.</em></li>
  <li> En la segunda columna escriba lo que entiende del audio que ha escuchado. Si entiendes solo unas pocas palabras de lo que dice el audio, escribe solo esas palabras aunque la oración no tenga sentido. Si no entiendes nada de lo que dice rellena con varias 'xxxxxxx'. En este columna no hace falta que ponga tildes, ni comas, ni puntos. Le pedimos que tenga cuidado con el resto de faltas de ortografías que afectarán a los resultados. </li>
  <li> En las últimas columnas se le pide que evalúe la calidad del audio de la persona y la similitud con la voz original con un puntaje del 0 al 5. Al evaluar si cree que la voz generada es igual a la original y con una calidad buena puntúe con un 5. Por el contrario, si crees que la voz generada no se parece o se escucha muy mal puntúe bajo el audio.</li>
  <li> Por último, presionar el botón de <strong>'Enviar Respuestas'</strong> y se almacenarán las respuestas en nuestra base.</li>
</ol>
  <p>Puedes repetir este proceso todas las veces que quieras con nuevas frases y cuántas más valoraciones realices más nos ayudarás en nuestro trabajo. <strong>¡Muchas Gracias por su Colaboración!</strong></p>
    <table>
        <tr>
            <th rowspan="2">Escriba que audio ha escuchado</th>
            <th rowspan="2"> Escriba lo que dice el Audio </th>
            <th colspan="6"> Valore la calidad del Audio </th>
        </tr>
        <tr>
           <!-- <td></td> -->
            <th> 0 </th>
            <th> 1 </th>
            <th> 2 </th>
            <th> 3 </th>
            <th> 4 </th>
            <th> 5 </th>
        </tr>
        <tr>
            <td class="editable" contenteditable="true" onfocus="limpiarTexto(this)">Escribe aquí</td>
            <td class="editable" contenteditable="true" onfocus="limpiarTexto(this)">Escribe aquí</td>
             <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 0)"></button> </td>
            <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 1)"></button> </td>
            <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 2)"></button> </td>
            <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 3)"></button> </td>
            <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 4)"></button> </td>
            <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 5)"></button> </td>
        </tr>
        <tr>
            <td class="editable" contenteditable="true" onfocus="limpiarTexto(this)">Escribe aquí</td>
            <td class="editable" contenteditable="true" onfocus="limpiarTexto(this)">Escribe aquí</td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 0)"></button> </td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 1)"></button> </td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 2)"></button> </td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 3)"></button> </td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 4)"></button> </td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 5)"></button> </td>
        </tr>
        <!-- Puedes agregar más filas si necesitas más registros -->
    </table>
    <button onclick="enviarDatos()">Enviar Respuestas</button>
    
    <script>
        function enviarRespuesta(pregunta, respuesta) {
          // Lógica para guardar las respuestas en variables o en algún objeto, según necesites
          console.log("Pregunta:", pregunta, "Respuesta:", respuesta);
        
          // Resaltar el botón pulsado en la fila de respuesta correspondiente
          if (pregunta === 'pregunta1') {
            var buttons = document.querySelectorAll(".button_circ.pregunta1");
            buttons.forEach(button => button.classList.remove("active"));
            buttons[respuesta].classList.add("active");
          } else if (pregunta === 'pregunta2') {
            var buttons = document.querySelectorAll(".button_circ.pregunta2");
            buttons.forEach(button => button.classList.remove("active"));
            buttons[respuesta].classList.add("active");
          }
        }


        function enviarDatos() {
            
            var filas = document.getElementsByTagName("tr");
            console.log(filas)
            var datos = [];
            console.log(filas.length)
            // Miramos a ver cuantas filas hay para guardar los datos
            for (var i = 2; i < filas.length; i++) {
                var celdas = filas[i].getElementsByTagName("td");
                console.log(celdas)
                var audioEscuchado = celdas[0].innerText;
                console.log(audioEscuchado)
                var textoEscuchado = celdas[1].innerText;
                console.log(textoEscuchado)

                // Lógica para obtener los valores de los botones pulsados
               
               
                var valorCalidad = -1;
                for (var j = 2; j < celdas.length; j++) {
                     var botones = celdas[j].getElementsByTagName("button");
                    for (let k = 0; k < botones.length; k++) {
                          if (botones[k].classList.contains("active")) {
                                valorCalidad = j-2;
                                break;
                          }
                    }
                    if (valorCalidad !== -1) {
                      break;
                    }
                }
                console.log(valorCalidad)
                // Guardar los datos en un objeto
                var dato = {
                    audio: audioEscuchado,
                    texto: textoEscuchado,
                    calidad: valorCalidad
                };
                datos.push(dato);
                console.log(datos);
            }

            // Enviar los datos utilizando fetch
            fetch("http://dihana.cps.unizar.es/encuestatts/guardar_datos.php", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(datos)
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                console.log("Datos enviados de manera correcta. Muchas gracias.")
                // Aquí puedes mostrar un mensaje de agradecimiento o redireccionar a otra página
            })
            .catch(error => {
                console.error("Error:", error);
            });
           alert("Respuestas enviadas correctamente.");
        }
        
        function limpiarTexto(elemento) {
            if (elemento.innerText === "Escribe aquí") {
                elemento.innerText = "";
                elemento.classList.remove("editable");
            }
        }
        
    </script>
</body>
</html>

