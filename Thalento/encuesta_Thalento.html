<!DOCTYPE html>
<html>
<head>
    <title>Registro de Audios</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }
        td.seleccionado {
            background-color: #e0e0e0; /* Gris claro */
        }
        audio {
            width: 100%;
        }

       .button_circ {
            background-color: #ccc; /* Color de fondo gris */
            color: black;
            border: none; /* Quitamos el borde */
            width: 20px; /* Ancho del botón */
            height: 20px; /* Altura del botón */
            border-radius: 50%; /* Hacemos que sea un círculo */
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }

        .button_circ.active {
            background-color: #ffa726;
            font-size: 8px;
            transform: scale(1.1);
        }
        td[contenteditable="true"] {
           background-color: #e0e0e0;
        }
        .editable {
            color: #888;
        }
        .editable:focus {
            color: black;
            outline: none;
        }
    </style>
</head>
<body>
    <h2>Registro de Audios</h2>
    <table>
        <tr>
            <th rowspan="2">Escriba que audio ha escuchado</th>
            <th rowspan="2"> Escriba lo que dice el Audio </th>
            <th colspan="6"> Valore la calidad del Audio </th>
        </tr>
        <tr>
           <!-- <td></td> -->
            <th> 0 </th>
            <th> 1 </th>
            <th> 2 </th>
            <th> 3 </th>
            <th> 4 </th>
            <th> 5 </th>
        </tr>
        <tr>
            <td class="editable" contenteditable="true" onfocus="limpiarTexto(this)">Escribe aquí</td>
            <td class="editable" contenteditable="true" onfocus="limpiarTexto(this)">Escribe aquí</td>
             <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 0)"></button> </td>
            <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 1)"></button> </td>
            <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 2)"></button> </td>
            <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 3)"></button> </td>
            <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 4)"></button> </td>
            <td> <button class="button_circ pregunta1" onclick="enviarRespuesta('pregunta1', 5)"></button> </td>
        </tr>
        <tr>
            <td class="editable" contenteditable="true" onfocus="limpiarTexto(this)">Escribe aquí</td>
            <td class="editable" contenteditable="true" onfocus="limpiarTexto(this)">Escribe aquí</td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 0)"></button> </td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 1)"></button> </td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 2)"></button> </td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 3)"></button> </td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 4)"></button> </td>
            <td> <button class="button_circ pregunta2" onclick="enviarRespuesta('pregunta2', 5)"></button> </td>
        </tr>
        <!-- Puedes agregar más filas si necesitas más registros -->
    </table>
    <button onclick="enviarDatos()">Enviar Respuestas</button>
    
    <script>
    function enviarRespuesta(pregunta, respuesta) {
        // Lógica para guardar las respuestas en variables o en algún objeto, según necesites
        console.log("Pregunta:", pregunta, "Respuesta:", respuesta);
        // Resaltar el botón pulsado
        var buttons = document.querySelectorAll(".button_circ." + pregunta); // Usamos la clase del botón para identificar la pregunta
        buttons.forEach(button => button.classList.remove("active"));
        buttons[respuesta].classList.add("active");
    
        // Asignar el valor de calidad a la fila correspondiente
        var filaRespuesta = document.getElementById("respuesta" + (pregunta === 'pregunta1' ? '1' : '2'));
        filaRespuesta.dataset.calidad = respuesta;
    }
        function enviarDatos() {
            var filas = document.getElementsByTagName("tr");
            var datos = [];

            for (var i = 2; i < filas.length; i++) {
                var celdas = filas[i].getElementsByTagName("td");
                var audioEscuchado = celdas[0].innerText;
                var textoEscuchado = celdas[1].innerText;

                // Lógica para obtener los valores de los botones pulsados
                var botones = celdas[2].getElementsByTagName("button");
                var valorCalidad = -1;
                for (var j = 0; j < botones.length; j++) {
                    if (botones[j].classList.contains("active")) {
                        valorCalidad = j;
                        break;
                    }
                }

                // Guardar los datos en un objeto
                var dato = {
                    audio: audioEscuchado,
                    texto: textoEscuchado,
                    calidad: valorCalidad
                };
                datos.push(dato);
                console.log(dato);
            }

            // Enviar los datos utilizando fetch
            fetch("http://dihana.cps.unizar.es/encuestatts/guardar_datos.php", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(datos)
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                console.log("Datos enviados de manera correcta. Muchas gracias.")
                // Aquí puedes mostrar un mensaje de agradecimiento o redireccionar a otra página
            })
            .catch(error => {
                console.error("Error:", error);
            });
        }
        
        function limpiarTexto(elemento) {
            if (elemento.innerText === "Escribe aquí") {
                elemento.innerText = "";
                elemento.classList.remove("editable");
            }
        }
        
    </script>
</body>
</html>

